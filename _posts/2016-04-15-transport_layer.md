---
title: 运输层（一）：概述
date: 2016-04-15
categories: Network
---

感觉自己计算机网络基础知识还是不太熟，所以打算好好讲里面的重点内容整理一下,将会分为四个部分对运输层进行总结，主要参考谢希仁编著的《计算机网络（第6版）》。本文是介绍运输层的第一篇，对运输层进行概述。

# 进程之间的通信

运输层向它的应用层提供通信服务，它属于面向通信部分的最高层，同时也是用户功能中的最低层。当网络的边缘部分中的两个主机使用网络的核心部分的功能进行端到端的通信时，只有主机的协议栈才有运输层（因为涉及到应用进程），而网络核心部分中的路由器在转发分组时都只用到下三层的功能。

运输层提供应用进程间的逻辑通信，运输层向高层用户屏蔽了下面网络核心的细节（如网络拓扑、所采用的网络选择协议等），它使应用进程看见的就是好像在两个运输层实体之间有一条端到端的逻辑通信信道，但这条逻辑通信信道对上层的表现却因运输层使用的不同协议而又很大的差别。当运输层采用面向连接的TCP协议时，尽管下面的网络是不可靠的（只提供尽最大努力服务），但这种逻辑通信信道就相当于一条全双工的可靠信道。但当运输层采用无连接的UDP协议时，这条逻辑通信信道仍然是一条不可靠信道。

网络层提供的是主机之间的逻辑通信。

# 运输层的端口

- **复用：**应用层所有的应用进程都可以通过运输层再传送到IP层（网络层）
- **分用：**运输层从IP层收到数据后必须交付指明的应用进程

通过上面可知，给应用层的每个应用进程赋予一个非常明确的标识是非常重要的。每个进程都有进程标识符，但是这个进程标识符不同的操作系统有不同的格式，并且，即使是特定进程由于其创建和撤销是动态的，通信的一方几乎无法识别对方机器的进程。解决这个问题的方法就是在运输层使用协议端口号。

在协议栈层间的抽象协议端口是软件端口，和路由器或交换机上的硬件端口是完全不同的概念。TCP/IP的运输层使用16位端口号，该端口号只具有本地意义，它只是为了标识本计算机应用层中的各个进程在和运输层交互时的层间接口。

总结下来，通过IP地址可以找到对方的计算机，通过端口可以找到对方计算机中的应用进程。

# 用户数据报协议 UDP

用户数据报协议 UDP只在 IP 的数据报服务之上增加了很少一点的功能，这就是复用和分用的功能以及差错检测的功能。UDP的主要特点是：

1. **UDP 是无连接的，**即发送数据之前不需要建立连接（当然，发送数据结束时也没有链接可释放），因此减少了开销和发送数据之前的时延。
2. **UDP 使用尽最大努力交付，**即不保证可靠交付，因此主机不需要维持复杂的链接状态表。
3. **UDP 是面向报文的。**UDP 对应用层交下来的报文，既不合并，也不拆分，应用层交给 UDP 多长的报文，UDP 就照样发送。也就是说，UDP 一次交付一个完整的报文，因此，应用程序必须选择合适大小的报文，若报文太长，UDP 把它交给 IP 层后，IP 层在传送时可能要进行分片，这会降低 IP 层的效率；反之，若报文太短，UDP 把它交给 IP 层后，会使 IP 数据报的首部的相对长度太大，这也较低了 IP 层的效率。
4. **UDP 没有拥塞控制，**因此网络出现的拥塞不会使源主机的发送速率降低。这对某些实时应用是很重要的。很多的实时应用（如 IP 电话、实时视频会议等）要求源主机以恒定的速率发送数据，并且允许在网络发生拥塞时丢失一些数据，但却不允许数据有太大的时延，UDP 就很合适。
5. **UDP 支持一对一、一对多、多对一和多对多的交互通信。**
6. **UDP 的首部开销小，**只有8个字节，比 TCP 的20个字节的首部要短。

UDP 的首部格式：由四个字段组成，源端口、目的端口、长度、校验和。

# 传输控制协议 TCP 

主要特点：

1. **面向链接的运输层协议。**
2. **点对点。**每一条 TCP 链接只能有两个端点，每一条 TCP 链接只能是点对点的。
2. **可靠交付。**通过 TCP 链接传送的数据，无差错、不丢失、不重复、并且按序到达。
3. **全双工通信。**TCP 允许通过双方的应用程序在任何时候都能发送数据。TCP 链接的两端都设有发送缓冲和接受缓冲。
4. **面向字节流。**TCP 中的“流”指的是流入到进程或从进程流出的字节序列。“面向字节流”的含义是：虽然应用程序和 TCP　的交互式一次一个数据块（大小不等），但 TCP 把应用程序交下来的数据看成仅仅是一连串的无结构的字节流。

TCP 把链接作为最基本的抽象。每一条 TCP 链接唯一地被通信两端的两个端口（即两个套接字）所确定。即：

> TCP 链接 ::= {socket1,socket2} = {(IP1:port), (IP2:port2)}

下面将要介绍　TCP 头部

![](http://7xrvqe.com1.z0.glb.clouddn.com/16-5-17/45908058.jpg)

1. **源端口和目的端口。**各占2个字节，TCP 的分用功能通过端口实现。
1. **序号。**占4个字节。序号的范围是[0,2^32-1]，共2^32个序号。序号使用 mod2^32 运算。TCP 是面向字节流的，在一个 TCP 连接中传送的字节流中的每一个字节都按顺序编号。该字段表示的是本报文段所发送的数据的第一个字节的序列号。
1. **确认号。**占4个字节，是期望对方下一个报文短的第一个数据字节的序号。确认号 N,表明的是到序列号 N-1 为止的所有数据都已经正确收到
1. **数据偏移。**占4位，表示 TCP 报文段的数据起始处距离 TCP 报文段的起始处的距离。单位是4个字节，所有数据偏移的最大值是60个字节，这也是 TCP 首部的最大长度。
1. **保留。**占6位，目前应设置为0。
1. **紧急 URG。**当 URG=1 时，表明紧急指针字段有效，它告诉系统此报文段中有紧急数据，应尽快传送（相当于高优先级），而不是按原来的排队顺序来传送。
1. **确认 ACK。**
1. **推送 PSH。**当两个应用进程进行交互式的通信时，有时在一端的应用进程希望在键入一个命令后立即就能够收到对方的响应。在这种情况下，TCP 就可以使用推送，发送方会立即创建并发送一个报文段，接收方会尽快的交付接受应用进程，而不再等到整个缓冲都填满后再向上交付。
1. **复位 RST。**当 RST=1 时，表明 TCP 连接中出现严重的差错，必须释放连接，然后再重新建立运输连接。RST 置 1 还用来拒绝一个非法的报文段或拒绝打开一个链接。
1. **同步 SYN。**
1. **终止 FIN。**
1. **窗口。**占 2 个字节。窗口指的是发送本报文段的接收窗口（而不是自己的发送窗口）。窗口字段明确指出了现在允许对方发送的数据量。窗口值是经常在动态变化着。
1. **校验和。**检验和字段检验的范围包括首部和数据这两个部分。
1. **紧急指针。**紧急指针仅当 URG=1 时才有意义，它指出紧急数据的末尾在报文段中的位置。即使窗口为零，也可以发送紧急数据。
1. **选线。**其中有个最大报文段长度 MSS，MSS 是每一个 TCP 报文段中的数据字段的最大长度。选项还包括选择确认（SACK）。

