---
title: C++11 新特性：右值引用
date: 2016-04-04
categories: C++
---

本文是对于《深入理解C++11：C++11新特性解析与应用》第三章第三小节“右值引用：移动语义和完美转发”的梳理。

# 1. 什么是右值引用

## 左值、纯右值、将亡值

左值（lvalue）、右值（rvalue）对于我们来说，并不陌生。常见的有两种分辨方法：

1. 在赋值表达式中，出现在星号左边的就是“左值”，而在等号右边的，则称为“右值”。
2. 可以取地址的、有名字的就是左值，反之，不能取地址的、没有名字的就是右值。

在 C++11 中，右值由两个概念构成，即，将亡值（xvalue）、纯右值（prvalue）。因此在 C++11 的程序中，所有的值必属于左值、将亡值、纯右值三者之一。下面举例说明下着三种值的例子。

- 纯右值就是 C++98 标准中右值的概念。如，非引用返回的函数返回的临时变量值，一些运算表达式产生的临时变量值，不跟对象关联的字面常量值（如，2、'c'、true），类型转换函数的返回值、lambda 表达式等。
- 将亡值则是 C++11 新增的跟右值引用相关的表达式，这样的表达式通常是将要被移动的对象（移为他用）。如，返回右值引用 T&& 的函数返回值，std::move 的返回值，转换为 T&& 的类型转换函数的返回值。
- 出去以上剩余的，可以表示函数、对象的值都属于左值。

## 左值引用和右值引用

右值引用和左值引用都是属于引用类型。无论是声明一个左值引用还是右值引用，都必须立即进行初始化。而其原因可以理解为是引用类型本身自己并不拥有所绑定对象的内存，只是改对象的一个别名。左值引用是具名变量值的别名，而右值引用是不具名（匿名）变量的别名。

## C++11中引用类型及其可以引用的值类型

![](http://7xrvqe.com1.z0.glb.clouddn.com/16-4-4/22188018.jpg)

从表中我们可以看出，常量左值引用是一个“万能引用”，但是引用的是右值，那么就变成常量右值，而常量右值通常是没有什么用途的。

在 <type_traits> 头文件中提供了3个模板类：is_rvalue_reference、is_lvalue_reference、is_reference，分别用来判断右值引用、左值引用、引用。

```c++
#include <iostream>
#include <type_traits>
using namespace std;

int main(){
	//cout<<boolalpha;
    string&& a= "我是右值引用";
    cout<< is_rvalue_reference<decltype(a)>::value<<endl;
    return 0;
}

//输出是：1
```