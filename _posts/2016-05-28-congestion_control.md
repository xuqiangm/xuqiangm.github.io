---
title: 传输层（四）：拥塞控制
date: 2016-05-28
categories: Network
---

**拥塞**：在某个时间，若对网络中某一资源的需求超过了该资源所能提供的可用部分，网络的性能就要变坏。

拥塞控制需要付出代价，在设计策略时，必须全面衡量得失。

![](http://7xrvqe.com1.z0.glb.clouddn.com/16-5-28/93162110.jpg)

# 拥塞控制与流量控制的区别

拥塞控制就是防止过多的数据注入到网络中，这样可以使网络中的路由器或链路不致过载。拥塞控制是一个全局性的过程。

流量控制往往指点对点通信量的控制，设个端到端的问题（接受端控制发送端）。流量控制所要做的就是抑制发送端发送数据的速率，以便使接收端来得及接收。

# 拥塞控制方法

拥塞控制的四种算法：慢开始、拥塞避免、快重传、快恢复。

在讨论之前假定：

- 数据总是单方向传送，而另一方向只传送确认
- 接收方总是有足够大的缓存空间，因而发送窗口的大小由网络的拥塞程度来决定。

### 慢开始和拥塞避免

发送方维持一个叫做拥塞窗口cwnd的状态变量。拥塞窗口的大小取决于网络的拥塞程度，并且动态地在变化。发送方让自己的发送窗口等于拥塞窗口。

发送方控制拥塞窗口的原则是：只要网络没有出现拥塞，拥塞窗口就再增大一些，以便把更多的分组发送出去。但只要网络出现拥塞，拥塞窗口就减少一些，以减少注入网络中的分组数。

通过一个图可以很好的解释慢开始和拥塞避免。

![](http://7xrvqe.com1.z0.glb.clouddn.com/16-5-28/50074328.jpg)

这两种算法合起来被成为 AIMD 算法（加法增大和乘法减小）

### 快重传和快恢复

快重传算法首先要求接收方没收到一个失序的报文段后就立即发出重复确认（为的是使发送方及早知道有报文段没有到达对方）而不要等待自己发送数据时才进行捎带确认。在下图的例子中，接收方收到了M1和M2后都分别发送了确认，现假定接收方没有收到M3但接着收到了M4。显然，接收方不能确认M4，因为M4是收到的失序报文段。依据可靠传输原理，接收方可以什么都不做，也可以在适当时机发送一次对 M2的确认。但按照快重传算法的规定，接收方应及时发送对M3的重复确认，这样做可以让发送方及早知道报文段M3没有到达接受方。发送方接着发送M5和M6。接收方收到后，也还要再次发出对 M2 的重复确认。这样，发送方共收到了接收方的四个对 M2 的确认，其中后三个都是重复确认。快重传算法规定，发送方只要一连收到三个重复确认就应当重传对方尚未收到的报文段 M3，而不必继续等待为M3设置的重传计时器到期。由于发送当能尽早重传未被确认的报文段，因此采用快重传后可以使整个网络的吞吐量提高约20%。

![](http://7xrvqe.com1.z0.glb.clouddn.com/16-5-28/44492421.jpg)

下面这个图可以很好的说明快恢复

![](http://7xrvqe.com1.z0.glb.clouddn.com/16-5-28/86930615.jpg)
